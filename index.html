<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vocabulary Coach – Open Source Lab</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 2rem;
      background: #f0f0f0;
      color: #333;
      transition: all 0.3s;
    }
    .dark-mode {
      background: #121212;
      color: #ddd;
    }
    input, textarea, button {
      font-size: 1rem;
      padding: 0.5rem;
      margin: 0.5rem 0;
      width: 100%;
    }
    .section {
      margin-bottom: 2rem;
    }
    .results, #challenge, #tip, #progressSummary, #wordnikOutput, #coachFeedback {
      background: #e6e6e6;
      padding: 1rem;
      border-radius: 8px;
    }
    .dark-mode .results, .dark-mode #challenge, .dark-mode #tip, .dark-mode #progressSummary, .dark-mode #wordnikOutput, .dark-mode #coachFeedback {
      background: #2b2b2b;
    }
    audio {
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>
  <button onclick="toggleDarkMode()">🌙/☀️</button>
  <h1>Vocabulary Coach – Open Source Lab</h1>

  <div class="section">
    <h2>1. Explore a Word</h2>
    <input id="wordInput" placeholder="Type an English word..." />
    <button onclick="analyzeWord()">Analyze</button>
    <button onclick="saveLearnedWord()">I learned this today 📌</button>
    <div id="output" class="results"></div>
    <div id="wordnikOutput"></div>
    <div id="coachFeedback"></div>
  </div>

  <div class="section">
    <h2>2. Context Practice</h2>
    <textarea id="story" rows="3" placeholder="Write a short story using the word..."></textarea>
    <textarea id="paraphrase" rows="2" placeholder="Now rewrite it without using the word..."></textarea>
    <button onclick="rewriteStory()">🔁 Ask Coach Alex to rewrite</button>
    <div id="rewriteOutput"></div>
  </div>

  <div class="section">
    <h2>3. Listening Practice</h2>
    <button onclick="startRecording()">🎙️ Record</button>
    <button onclick="stopRecording()">⏹️ Stop</button>
    <div id="recordingsList"></div>
  </div>

  <div class="section">
    <h2>4. Daily Challenge</h2>
    <div id="challenge"></div>
  </div>

  <div class="section">
    <h2>5. Tip of the Day</h2>
    <div id="tip"></div>
  </div>

  <div class="section">
    <h2>📊 Progress Summary</h2>
    <div id="progressSummary"></div>
  </div>

  <script>
    let mediaRecorder, audioChunks = [];

    const tips = [
      "Avoid 'do a mistake'. Say 'make a mistake'.",
      "Use 'run' for managing things: 'run a business'.",
      "'Get' has many meanings: get married, get tired, get ready.",
      "'Look after' means take care of someone or something.",
      "Use 'used to' for past habits: I used to play piano."
    ];

    const challenges = [
      "Say 3 synonyms for a common verb.",
      "Tell a story in past using a phrasal verb.",
      "Say a formal sentence and its informal version.",
      "Use an idiom in a sentence (e.g., break the ice).",
      "Turn a positive sentence into a negative one."
    ];

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }

    function analyzeWord() {
  const word = document.getElementById("wordInput").value.trim().toLowerCase();
  if (!word) return;

  const output = document.getElementById("output");
  const links = {
    "🔤 Cambridge Dictionary": `https://dictionary.cambridge.org/dictionary/english/${word}`,
    "🧠 Skell Examples": `https://skell.sketchengine.eu/#result?lang=en&query=${word}`,
    "📚 Reverso Context": `https://context.reverso.net/translation/english-spanish/${word}`,
    "📖 Ludwig.guru": `https://ludwig.guru/s/${word}`,
    "🎧 YouGlish": `https://youglish.com/pronounce/${word}/english/us`
  };

  output.innerHTML = `<strong>Word:</strong> ${word}<br><br>`;
  for (const [label, url] of Object.entries(links)) {
    output.innerHTML += `<a href="${url}" target="_blank">${label}</a><br>`;
  }

  fetch(`https://api.wordnik.com/v4/word.json/${word}/definitions?limit=2&api_key=YOUR_WORDNIK_API_KEY`)
    .then(res => res.json())
    .then(data => {
      const defDiv = document.getElementById("wordnikOutput");
      if (data.length > 0) {
        defDiv.innerHTML = `<strong>Definitions from Wordnik:</strong><ul>` +
          data.map(d => `<li>${d.text}</li>`).join('') + `</ul>`;
      } else {
        defDiv.innerHTML = "No definitions found.";
      }
    });

  fetch(`https://api.api-ninjas.com/v1/thesaurus?word=${word}`, {
    headers: { 'X-Api-Key': 'YOUR_API_NINJAS_KEY' }
  })
    .then(res => res.json())
    .then(data => {
      const coach = document.getElementById("coachFeedback");
      if (data.synonyms || data.antonyms) {
        coach.innerHTML = `👋 Coach Alex says: <br>` +
          (data.synonyms ? `<strong>Synonyms:</strong> ${data.synonyms.join(", ")}<br>` : '') +
          (data.antonyms ? `<strong>Antonyms:</strong> ${data.antonyms.join(", ")}` : '');
      } else {
        coach.innerHTML = `👋 Coach Alex says: No synonyms or antonyms found.`;
      }
    })
    .catch(() => {
      document.getElementById("coachFeedback").innerHTML =
        `👋 Coach Alex says: Nice choice! Don't forget to use '${word}' in a sentence today!`;
    });
}
          if (data.length > 0) {
            defDiv.innerHTML = `<strong>Definitions from Wordnik:</strong><ul>` +
              data.map(d => `<li>${d.text}</li>`).join('') + `</ul>`;
          } else {
            defDiv.innerHTML = "No definitions found.";
          }
        });

      const coach = document.getElementById("coachFeedback");
      coach.innerHTML = `👋 Coach Alex says: “Nice choice! Don't forget to use '${word}' in a sentence today!”`;
    }

    function startRecording() {
      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(stream => {
          mediaRecorder = new MediaRecorder(stream);
          mediaRecorder.start();
          audioChunks = [];

          mediaRecorder.addEventListener("dataavailable", event => {
            audioChunks.push(event.data);
          });

          mediaRecorder.addEventListener("stop", () => {
            const audioBlob = new Blob(audioChunks);
            const audioUrl = URL.createObjectURL(audioBlob);
            const audio = document.createElement("audio");
            audio.controls = true;
            audio.src = audioUrl;
            document.getElementById("recordingsList").appendChild(audio);
            saveProgress("recording", audioUrl);
          });
        });
    }

    function stopRecording() {
      if (mediaRecorder) mediaRecorder.stop();
    }

    function randomDaily(seedArray, key, containerId) {
      const today = new Date().toISOString().slice(0, 10);
      const stored = JSON.parse(localStorage.getItem(key)) || {};
      if (stored.date === today) {
        document.getElementById(containerId).innerText = stored.value;
      } else {
        const pick = seedArray[Math.floor(Math.random() * seedArray.length)];
        document.getElementById(containerId).innerText = pick;
        localStorage.setItem(key, JSON.stringify({ date: today, value: pick }));
      }
    }

    function saveLearnedWord() {
      const word = document.getElementById("wordInput").value.trim();
      if (!word) return;
      const learned = JSON.parse(localStorage.getItem("learnedWords") || "[]");
      learned.push({ word, date: new Date().toISOString() });
      localStorage.setItem("learnedWords", JSON.stringify(learned));
      updateProgress();
    }

    function saveProgress(type, value) {
      const progress = JSON.parse(localStorage.getItem("progress") || "[]");
      progress.push({ type, value, date: new Date().toISOString() });
      localStorage.setItem("progress", JSON.stringify(progress));
    }

    function updateProgress() {
      const learned = JSON.parse(localStorage.getItem("learnedWords") || "[]");
      const progress = JSON.parse(localStorage.getItem("progress") || "[]");
      const words = learned.length;
      const recordings = progress.filter(p => p.type === "recording").length;
      const days = [...new Set(learned.map(w => w.date.slice(0, 10)))].length;

      document.getElementById("progressSummary").innerHTML =
        `Words practiced: <strong>${words}</strong><br>` +
        `Voice recordings: <strong>${recordings}</strong><br>` +
        `Active days: <strong>${days}</strong>`;
    }

    function rewriteStory() {
      const story = document.getElementById("story").value.trim();
      const word = document.getElementById("wordInput").value.trim();
      if (!story) return;
      document.getElementById("rewriteOutput").innerHTML =
        `🧑‍🏫 Coach Alex: Here's a better version:<br><em>"${story.replace(word, '...')}"</em><br><small>(In future, this will be powered by AI.)</small>`;
    }

    // Init
    randomDaily(challenges, "dailyChallenge", "challenge");
    randomDaily(tips, "dailyTip", "tip");
    updateProgress();
  </script>
</body>
</html>
